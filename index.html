<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ResumeFox AI â€” Prototype</title>

  <style>
    :root{
      --bg:#ffffff;
      --muted:#6b7280;
      --accent:#ff914d;
      --btn-bg:#e6f0ff;
      --success:#16a34a;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#f9fafb;
      padding:32px;
    }

    .card{
      width:100%;
      max-width:800px;
      background:white;
      border-radius:16px;
      padding:48px;
      box-shadow:0 6px 24px rgba(0,0,0,.08);
      text-align:center;
    }

    h1{margin-bottom:4px}
    .subtitle{color:var(--muted);margin-bottom:28px}

    .btn{
      padding:14px 22px;
      border-radius:999px;
      border:0;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
    }

    .btn-upload{
      background:var(--btn-bg);
      margin-bottom:8px;
    }

    .btn-cta{
      background:var(--accent);
      color:white;
      margin-top:12px;
    }

    input[type=file]{display:none}
    .small{font-size:13px;color:var(--muted)}

    .processing{display:none;margin-top:24px}
    .results{display:none;margin-top:32px;text-align:left}

    .score{
      text-align:center;
      font-size:26px;
      font-weight:700;
      color:#2563eb;
      margin-bottom:16px;
    }

    ul{padding-left:18px;color:#374151}

    .action-pill{
      display:inline-block;
      margin-top:8px;
      padding:10px 16px;
      border-radius:999px;
      color:white;
      background:var(--success);
      font-weight:700;
    }
  </style>
</head>

<body>
<div class="card">

  <h1>ResumeFox AI ðŸ¦Š</h1>
  <div class="subtitle">Smart Resume-to-Job Matching Tool</div>

  <label class="btn btn-upload">
    <input id="fileResume" type="file" accept=".txt">
    Upload Resume
  </label>
  <div id="resumeStatus" class="small"></div>

  <label class="btn btn-upload">
    <input id="fileJD" type="file" accept=".txt">
    Upload Job Description
  </label>
  <div id="jdStatus" class="small"></div>

  <button id="analyzeBtn" class="btn btn-cta">Analyze Match</button>
  <div class="small">Upload small .txt files for demo</div>

  <div id="processing" class="processing">
    <p><b>Analyzing Resumeâ€¦</b></p>
  </div>

  <div id="results" class="results">
    <div class="score" id="scoreText"></div>

    <h3>Strengths</h3>
    <ul id="strengthsList"></ul>

    <h3>Weaknesses</h3>
    <ul id="weaknessesList"></ul>

    <h3>Recommended Action</h3>
    <div id="actionPill" class="action-pill"></div>

    <br><br>
    <button id="again" class="btn btn-upload">Analyze Another</button>
  </div>

</div>

<script>
const fileResume = document.getElementById("fileResume");
const fileJD = document.getElementById("fileJD");
const resumeStatus = document.getElementById("resumeStatus");
const jdStatus = document.getElementById("jdStatus");

const processing = document.getElementById("processing");
const results = document.getElementById("results");
const analyzeBtn = document.getElementById("analyzeBtn");

let resumeText = "";
let jdText = "";

function readFile(file){
  return new Promise((res)=>{
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.readAsText(file);
  });
}

fileResume.onchange = async e => {
  resumeText = await readFile(e.target.files[0]);
  resumeStatus.textContent = "Resume Uploaded âœ”";
};

fileJD.onchange = async e => {
  jdText = await readFile(e.target.files[0]);
  jdStatus.textContent = "Job Description Uploaded âœ”";
};

analyzeBtn.onclick = async () => {
  if(!resumeText || !jdText){
    alert("Upload both resume and JD first!");
    return;
  }

  processing.style.display = "block";
  results.style.display = "none";

  try {
    const res = await fetch(
      "https://ankitasuryawanshi400.app.n8n.cloud/webhook/resumefox-compare",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ resume: resumeText, jd: jdText })
      }
    );

    const data = await res.json();

    // ðŸ‘‡ THIS IS THE IMPORTANT FIX
    let raw = data.candidates[0].content.parts[0].text;

    raw = raw.replace(/```json|```/g,"").trim();
    const ai = JSON.parse(raw);

    showResults(ai);

  } catch(err){
    console.error(err);
    alert("Backend error â€” check n8n workflow");
  }
};

function showResults(ai){
  processing.style.display="none";
  results.style.display="block";

  document.getElementById("scoreText").textContent =
    `Match Score: ${ai.score} / 100`;

  const s = document.getElementById("strengthsList");
  const w = document.getElementById("weaknessesList");
  s.innerHTML = ""; w.innerHTML = "";

  ai.strengths.forEach(x=>{
    const li=document.createElement("li");
    li.textContent=x;
    s.appendChild(li);
  });

  ai.weaknesses.forEach(x=>{
    const li=document.createElement("li");
    li.textContent=x;
    w.appendChild(li);
  });

  const pill=document.getElementById("actionPill");
  pill.textContent = ai.recommended_action;
  pill.style.background =
    ai.recommended_action==="Interview" ? "#16a34a" : "#f59e0b";
}

document.getElementById("again").onclick = ()=>{
  results.style.display="none";
  resumeText=""; jdText="";
  fileResume.value=""; fileJD.value="";
  resumeStatus.textContent=""; jdStatus.textContent="";
};
</script>

</body>
</html>
